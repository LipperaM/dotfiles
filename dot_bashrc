# If not running interactively, don't do anything (leave this at the top of this file)
[[ $- != *i* ]] && return

# All the default Omarchy aliases and functions
# (don't mess with these directly, just overwrite them here!)
source ~/.local/share/omarchy/default/bash/rc

# Add your own exports, aliases, and functions here.
#
# Make an alias for invoking commands you use constantly
# alias p='python'


# Created by `pipx` on 2025-12-21 23:30:01
export PATH="$PATH:/home/bennet/.local/bin"

# Export SSH_AGENT vars
export SSH_AUTH_SOCK="$XDG_RUNTIME_DIR/ssh-agent.socket"

# Pomodoro timer script
function pomo() {
    local work_min=$1
    local break_min=$2
    local long_break_min=$3
    local sound="/usr/share/sounds/freedesktop/stereo/complete.oga"

    if [[ $# -ne 3 ]]; then
        echo "usage: pomo <work_time> <break_time> <long_break_time>"
        return 1
    fi

    if ! [[ $work_min =~ ^[0-9]+$ && $break_min =~ ^[0-9]+$ && $long_break_min =~ ^[0-9]+$ ]]; then
        echo "arguments must be integers"
        return 1
    fi

    local work_sec=$((work_min * 60))
    local break_sec=$((break_min * 60))
    local long_break_sec=$((long_break_min * 60))

    cleanup() {
        # eliminar hijos del script
        pkill -P $$
        # salir del script
        exit 1
    }

    # capturar CTRL+C, cierre de terminal, y fin normal
    trap cleanup SIGINT SIGTERM SIGHUP EXIT

    local cycle=0

    while true; do
        notify-send -a pomo "Working time" "Focus (${work_min} min)" &
        paplay "$sound" &
        sleep "$work_sec"

        ((cycle++))

        if (( cycle % 3 == 0 )); then
            notify-send -a pomo "Long break" "Rest (${long_break_min} min)" &
            paplay "$sound" &
            sleep "$long_break_sec"
        else
            notify-send -a pomo "Break time" "Rest (${break_min} min)" &
            paplay "$sound" &
            sleep "$break_sec"
        fi
    done
}
